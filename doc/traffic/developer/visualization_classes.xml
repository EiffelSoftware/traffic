<?xml version="1.0" encoding="UTF-8"?>
<chapter xmlns="http://www.gobosoft.com/eiffel/gobo/documentation" id="traffic/developer/tr_visualization/classes">
<chapterinfo>
	<copyright>
		<year>2005</year>
		<holder>Michela Pedroni</holder>
	</copyright>
    <email>michela.pedroni@inf.ethz.ch</email>
	<date>$Date$</date>
</chapterinfo>
    <title>Traffic visualization classes</title>
	<section id="top_of_page">
    	<para>
			In the following sections the classes will be described. The layout for each class is: 
			Requirements, Description, Class overview. In the Requirements section the name of classes you 
			need to know in order to understand the class described is given. Description is a short 
			description of what the class does. It is more detailed than just the class description 
			that you find in the class header. The class overview provides you with a class diagram. 
		</para>
		<itemizedlist>
			<listitem>
				<link url="#traffic_3d_building_factory">TRAFFIC_3D_BUILDING_FACTORY, TRAFFIC_3D_BUILDING_SIMPLE_FACTORY, TRAFFIC_3D_BUILDING_FANCY_FACTORY</link>
			</listitem>
			<listitem>
				<link url="#traffic_3d_building_representation">TRAFFIC_3D_BUILDING_REPRESENTATION</link>
			</listitem>
			<listitem>
				<link url="#traffic_3d_connection_factory">TRAFFIC_3D_CONNECTION_FACTORY, TRAFFIC_3D_CONNECTION_HIGHLIGHTED_REP_FACTORY, TRAFFIC_3D_CONNECTION_LINE_REP_FACTORY</link>
			</listitem>
			<listitem>
				<link url="#traffic_3d_constants">TRAFFIC_3D_CONSTANTS</link>
			</listitem>
			<listitem>
				<link url="#traffic_3d_drawing_primitives">TRAFFIC_3D_DRAWING_PRIMITIVES</link>
			</listitem>
			<listitem>
				<link url="#traffic_3d_line_representation">TRAFFIC_3D_LINE_REPRESENTATION</link>
			</listitem>
			<listitem>
				<link url="#traffic_3d_map_widget">TRAFFIC_3D_MAP_WIDGET</link>
			</listitem>
			<listitem>
				<link url="#traffic_3d_obj_loader">TRAFFIC_3D_OBJ_LOADER</link>
			</listitem>
			<listitem>
				<link url="#traffic_3d_path_representation">TRAFFIC_3D_PATH_REPRESENTATION</link>
			</listitem>
			<listitem>
				<link url="#traffic_3d_place_factory">TRAFFIC_3D_PLACE_FACTORY, TRAFFIC_3D_PLACE_CIRCLE_REP_FACTORY, TRAFFIC_3D_PLACE_SQUARE_REP_FACTORY</link>
			</listitem>
			<listitem>
				<link url="#traffic_3d_place_representation">TRAFFIC_3D_PLACE_REPRESENTATION</link>
			</listitem>
			<listitem>
				<link url="#traffic_3d_road_representation">TRAFFIC_3D_ROAD_REPRESENTATION</link>
			</listitem>
			<listitem>
				<link url="#traffic_3d_sun_representation">TRAFFIC_3D_SUN_REPRESENTATION</link>
			</listitem>
			<listitem>
				<link url="#traffic_3d_texture_object">TRAFFIC_3D_TEXTURE_OBJECT</link>
			</listitem>
			<listitem>
				<link url="#traffic_3d_text_scanner">TRAFFIC_3D_TEXT_SCANNER</link>
			</listitem>
			<listitem>
				<link url="#traffic_3d_traveler_representation">TRAFFIC_3D_TRAVELER_REPRESENTATION</link>
			</listitem>
		</itemizedlist>
    </section>
	<section id="traffic_3d_building_factory">
    	<title>TRAFFIC_3D_BUILDING_FACTORY, TRAFFIC_3D_BUILDING_SIMPLE_FACTORY, TRAFFIC_3D_BUILDING_FANCY_FACTORY</title>
   		<title>Requirements:</title>
    	<para>
    		<classname>EM_3D_OBJECT_FACTORY, TRAFFIC_3D_OBJ_LOADER</classname>
    	</para>
    	<title>Description</title>
    	<para>
			The class <classname>TRAFFIC_3D_BUILDING_FACTORY</classname> is a deferred factory for the 3D objects which represent the buildings on the map. At the moment two factories are effective descendants of this class: <classname>TRAFFIC_3D_BUILDING_SIMPLE_FACTORY</classname> and <classname>TRAFFIC_3D_BUILDING_FANCY_FACTORY</classname>. The class <classname>TRAFFIC_3D_BUILDING_REPRESENTATION</classname> uses one of these factories to generate new building views. Through a call to <featurename>create_object</featurename> which is inherited from <classname>EM_3D_OBJECT_FACTORY</classname> a new 3d object is created and returned.
    	</para>
    	<title>Class overview</title>
    	<para>
    	<para>
    		<image src="image/traffic_3d_building_factory.png"/>
    	</para>
    	</para>
    	<toplink/>
	</section>
	<section id="traffic_3d_building_representation">
    	<title>TRAFFIC_3D_BUILDING_REPRESENTATION</title>
   		<title>Requirements:</title>
    	<para>
			<classname>TRAFFIC_BUILDING, TRAFFIC_3D_CONSTANTS, TRAFFIC_BUILDING_FACTORY</classname>
    	</para>
    	<title>Description</title>
    	<para>
			 The class <classname>TRAFFIC_3D_BUILDING_REPRESENTATION</classname> is a container for all traffic building 3D objects. As expected there is a feature <featurename>draw</featurename> to draw all objects in the container. <newline/> 
			 Buildings can be highlighted or un-highlighted by calling the features <featurename>highlight_building</featurename> or <featurename>unhighlight_building</featurename>. With the feature <featurename>add_building</featurename> a building can be added to the representation and <featurename>delete_one_building</featurename> respectively <featurename>delete_buildings</featurename> deletes one specific respectively all the buildings from the representation.
    	</para>
    	<title>Class overview</title>
    	<para>
    	<para>
    		<image src="image/traffic_3d_building_representation.png"/>
    	</para>
    	</para>
    	<toplink/>
    </section>
	<section id="traffic_3d_connection_factory">
    	<title>TRAFFIC_3D_CONNECTION_FACTORY, TRAFFIC_3D_CONNECTION_LINE_REP_FACTORY, TRAFFIC_3D_CONNECTION_HIGHLIGHTED_REP_FACTORY</title>
   		<title>Requirements:</title>
    	<para>
    		<classname>EM_3D_OBJECT_FACTORY</classname>
    	</para>
    	<title>Description</title>
    	<para>
			The class <classname>TRAFFIC_3D_CONNECTION_FACTORY</classname> is a factory for the 3D objects which represent the connections (be it roads, line sections or paths) on the map. Additionally, to the features inherited from <classname>EM_3D_OBJECT_FACTORY</classname> (such as <featurename>create_object</featurename> which creates a new 3d object) the class <classname>TRAFFIC_3D_CONNECTION_FACTORY</classname> always also creates a collision polygon for a new 3d object. To specify for which connection a new 3d object needs to be created use <featurename>set_connection</featurename>.
    	</para>
    	<title>Class overview</title>
    	<para>
    	<para>
    		<image src="image/traffic_3d_connection_factory.png"/>
    	</para>
    	</para>
    	<toplink/>
    </section>
    <section id="traffic_3d_constants">
    	<title>TRAFFIC_3D_CONSTANTS</title>
   		<title>Requirements:</title>
    	<para>
    		None
    	</para>
    	<title>Description</title>
    	<para>
			This class is shared by all other classes in this section. It has some default values like <featurename>window_width</featurename>
			or <featurename>place_height</featurename>. Another feature <featurename>map_to_gl_coords</featurename> can be found in this class.
			This feature translates given coordinates to coordinates according to the map.
    	</para>
    	<title>Class overview</title>
    	<para>
    	<para>
    		<image src="image/traffic_3d_constants.png"/>
    	</para>
    	</para>
    	<toplink/>
    </section>
    <section id="traffic_3d_drawing_primitives">
    	<title>TRAFFIC_3D_DRAWING_PRIMITIVES</title>
   		<title>Requirements:</title>
    	<para>
    		<classname>GL_FUNCTIONS, GLU_FUNCTIONS, EM_CONSTANTS</classname>
    	</para>
    	<title>Description</title>
    	<para>
			The class <classname>TRAFFIC_3D_DRAWING_PRIMITIVES</classname> provides basic features for drawing 3d objects such as <featurename>create_circle</featurename>, <featurename>create_cube</featurename>, and <featurename>create_cylinder</featurename>.
    	</para>
    	<title>Class overview</title>
    	<para>
    	<para>
    		<image src="image/traffic_3d_drawing_primitives.png"/>
    	</para>
    	</para>
    	<toplink/>
    </section>
	<section id="traffic_3d_line_representation">
    	<title>TRAFFIC_3D_LINE_REPRESENTATION</title>
   		<title>Requirements:</title>
    	<para>
    		<classname>EM_3D_OBJECT</classname>,
			<classname>TRAFFIC_3D_CONSTANTS</classname>
    	</para>
    	<title>Description</title>
    	<para>
			The class <classname>TRAFFIC_3D_LINE_REPRESENTATION</classname> is a container for all traffic line 3D objects. As expected there is a feature <featurename>draw</featurename> to draw all objects	in the container. Lines can be highlighted or un-highlighted by calling the features <featurename>highlight_single_line</featurename> and <featurename>un_highlight_single_line</featurename>. With the feature <featurename>add_lines</featurename> all lines of a map can be added, but single lines can be added too. <classname>TRAFFIC_3D_LINE_REPRESENTATION</classname> uses descendants of <classname>TRAFFIC_3D_CONNECTION_FACTORY</classname> to create the 3d objects.
    	</para>
    	<title>Class overview</title>
    	<para>
    	<para>
    		<image src="image/traffic_3d_line_representation.png"/>
    	</para>
    	</para>
    	<toplink/>
    </section>
	<section id="traffic_3d_map_widget">
    	<title>TRAFFIC_3D_MAP_WIDGET</title>
   		<title>Requirements:</title>
    	<para>
			<classname>EM_3D_COMPONENT</classname>,
			<classname>TRAFFIC_3D_CONSTANTS, TRAFFIC_BUILDING_REPRESENTATION, TRAFFIC_PLACE_REPRESENTAION, TRAFFIC_LINE_REPRESENTATION, TRAFFIC_PATH_REPRESENTATION, TRAFFIC_SUN_REPRESENTATION, TRAFFIC_TRAVELER_REPRESENTATION</classname>
    	</para>
    	<title>Description</title>
    	<para>
			The <classname>TRAFFIC_3D_MAP_WIDGET</classname> class is the main class in this cluster. As seen in the overview it contains all the representations of buildings, lines, places and travelers. It represents the whole map which can be plugged into an <classname>EM_3D_SCENE</classname>. It provides the feature <featurename>draw</featurename> that draws all the city elements onto the screen. The feature <featurename>collision_polygons</featurename> returns a list of polygons which is useful for searching for a collision (e.g. used for placing buildings). The feature <featurename>set_map</featurename> is used to set the map to be displayed and creates all the visual representation needed for display.
    	</para>
		<para>
			There is a feature to place buildings randomly (<featurename>place_buildings_randomly</featurename>) which places several randomly distributed buildings on the map. The buildings are first placed along the line sections, then on the rest of the map. A two dimensional boolean grid is used to check for collisions. It is possible to delete all the buildings with the feature <featurename>delete_buildings</featurename>. <newline/>
		</para>
		<para>
			It is also possible to get informed if a building is clicked. If a class needs this functionality, it has to subscribe to <featurename>building_clicked_event</featurename>.
		</para>
    	<title>Class overview</title>
    	<para>
    	<para>
    		<image src="image/traffic_3d_map_widget.png"/>
    	</para>
    	</para>
    	<toplink/>
    </section>
	<section id="traffic_3d_obj_loader">
    	<title>TRAFFIC_3D_OBJ_LOADER</title>
   		<title>Requirements:</title>
    	<para>
    		<classname>EM_3D_OBJECT_FACTORY</classname>
    	</para>
    	<title>Description</title>
    	<para>
			This class is provides facilities to load OpenGl 3d objects from *.obj files (Wavefront object files). It uses caching to optimize the recurring loading of such files.
		</para>
    	<title>Class overview</title>
    	<para>
    		<image src="image/traffic_3d_obj_loader.png"/>
    	</para>
    	<toplink/>
    </section>
	<section id="traffic_3d_path_representation">
    	<title>TRAFFIC_3D_PATH_REPRESENTATION</title>
   		<title>Requirements:</title>
    	<para>
    		<classname>EM_3D_OBJECT</classname>,
			<classname>TRAFFIC_3D_CONSTANTS, TRAFFIC_3D_CONNECTION_FACTORY</classname>
    	</para>
    	<title>Description</title>
    	<para>
			The class <classname>TRAFFIC_3D_PATH_REPRESENTATION</classname> is a container for all traffic path 3D objects. As expected there is a feature <featurename>draw</featurename> to draw all objects in the container. <classname>TRAFFIC_3D_PATH_REPRESENTATION</classname> uses descendants of <classname>TRAFFIC_3D_CONNECTION_FACTORY</classname> to create the 3d objects.
     	</para>
    	<title>Class overview</title>
    	<para>
    	<para>
    		<image src="image/traffic_3d_path_representation.png"/>
    	</para>
    	</para>
    	<toplink/>
	</section>
	<section id="traffic_3d_place_factory">
    	<title>TRAFFIC_3D_PLACE_FACTORY, TRAFFIC_3D_PLACE_CIRCLE_REP_FACTORY, TRAFFIC_3D_PLACE_SQUARE_REP_FACTORY</title>
   		<title>Requirements:</title>
    	<para>
    		<classname>EM_3D_OBJECT_FACTORY</classname>
    	</para>
    	<title>Description</title>
    	<para>
			The class <classname>TRAFFIC_3D_PLACE_FACTORY</classname> is a deferred factory for the 3D objects which represent the places on the map. Additionally, to the features inherited from <classname>EM_3D_OBJECT_FACTORY</classname> (such as <featurename>create_object</featurename> which creates a new 3d object) the class <classname>TRAFFIC_3D_PLACE_FACTORY</classname> always also creates a collision polygon for a new 3d object. To specify for which connection a new 3d object needs to be created use <featurename>set_connection</featurename>. <classname>TRAFFIC_3D_PLACE_CIRCLE_REP_FACTORY</classname> and <classname>TRAFFIC_3D_PLACE_SQUARE_REP_FACTORY</classname> 
    	</para>
    	<title>Class overview</title>
    	<para>
    	<para>
    		<image src="image/traffic_3d_place_factory.png"/>
    	</para>
    	</para>
    	<toplink/>
    </section>
	<section id="traffic_3d_place_representation">
    	<title>TRAFFIC_3D_PLACE_REPRESENTATION</title>
   		<title>Requirements:</title>
    	<para>
    		<classname>TRAFFIC_3D_CONSTANTS</classname>
    	</para>
    	<title>Description</title>
    	<para>
			The class supports the feature <featurename>draw</featurename> to draw all places. The feature <featurename>highlight_place</featurename> highlights a place.	Through the feature <featurename>add_places</featurename> all places of a map are added to the container.
    	</para>
    	<title>Class overview</title>
    	<para>
    	<para>
    		<image src="image/traffic_3d_place_representation.png"/>
    	</para>
    	</para>
    	<toplink/>
    </section>
	<section id="traffic_3d_road_representation">
    	<title>TRAFFIC_3D_ROAD_REPRESENTATION</title>
   		<title>Requirements:</title>
    	<para>
    		<classname>EM_3D_OBJECT</classname>
			<classname>TRAFFIC_3D_CONSTANTS</classname>
    	</para>
    	<title>Description</title>
    	<para>
			The class <classname>TRAFFIC_3D_ROAD_REPRESENTATION</classname> is a container for all traffic road 3D objects. As expected there is a feature <featurename>draw</featurename> to draw all objects	in the container. In the feature <featurename>draw</featurename> each type of road is associated to a particular representation on the map.<classname>TRAFFIC_3D_ROAD_REPRESENTATION</classname> uses descendants of <classname>TRAFFIC_3D_CONNECTION_FACTORY</classname> to create the 3d objects.</para> 
    	<title>Class overview</title>
    	<para>
    	<para>
    		<image src="image/traffic_3d_road_representation.png"/>
    	</para>
    	</para>
    	<toplink/>
    </section>
	<section id="traffic_3d_sun_representation">
    	<title>TRAFFIC_3D_SUN_REPRESENTATION</title>
   		<title>Requirements:</title>
    	<para>
			<classname>TRAFFIC_SHARED_TIME</classname>
    	</para>
    	<title>Description</title>
    	<para>
			The class <classname>TRAFFIC_3D_SUN_REPRESENTATION</classname> provides the facilities to display a sun that is moving according to the current simulated time in the system. Therefore, it uses <classname>TRAFFIC_SHARED_TIME</classname>.
		</para>
    	<title>Class overview</title>
    	<para>
    	<para>
    		<image src="image/traffic_3d_sun_representation.png"/>
    	</para>
    	</para>
    	<toplink/>
    </section>
	<section id="traffic_3d_texture_object">
    	<title>TRAFFIC_3D_TEXTURE_OBJECT</title>
   		<title>Requirements:</title>
    	<para>
			<classname>EM_3D_OBJECT</classname>
    	</para>
    	<title>Description</title>
    	<para>
			The class <classname>TRAFFIC_3D_TEXTURE_OBJECT</classname> is an extended <classname>EM_3D_OBJECT</classname>, i.e. an OpenGL displaylist that can have textures (bitmaps that are wrapped around the skeleton object).
		</para>
    	<title>Class overview</title>
    	<para>
    	<para>
    		<image src="image/traffic_3d_texture_object.png"/>
    	</para>
    	</para>
    	<toplink/>
    </section>
	<section id="traffic_3d_text_scanner">
    	<title>TRAFFIC_3D_TEXT_SCANNER</title>
   		<title>Requirements:</title>
    	<para>
			None
    	</para>
    	<title>Description</title>
    	<para>
			The class <classname>TRAFFIC_3D_TEXT_SCANNER</classname> is a string tokenizer used for reading *.obj files (see class <classname>TRAFFIC_3D_OBJ_LOADER</classname>.
		</para>
    	<title>Class overview</title>
    	<para>
    	<para>
    		<image src="image/traffic_3d_text_scanner.png"/>
    	</para>
    	</para>
    	<toplink/>
    </section>
	<section id="traffic_3d_traveler_representation">
    	<title>TRAFFIC_3D_TRAVELER_REPRESENTATION</title>
   		<title>Requirements:</title>
    	<para>
    		<classname>TRAFFIC_3D_CONSTANTS, TRAFFIC_3D_OBJ_LOADER</classname>
    	</para>
    	<title>Description</title>
    	<para>
			Like all other containers the feature <featurename>draw</featurename> is also provided to draw all travelers. To add a traveler call <featurename>add_traveler</featurename>. As factory for 3d objects it uses <classname>TRAFFIC_3D_OBJ_LOADER</classname>. 
    	</para>
    	<title>Class overview</title>
    	<para>
    	<para>
    		<image src="image/traffic_3d_traveler_representation.png"/>
    	</para>
    	</para>
    	<toplink/>
    </section>

</chapter>

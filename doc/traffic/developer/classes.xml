<?xml version="1.0" encoding="UTF-8"?>
<!--
	description:

		"Developer guide for the Traffic library"

	copyright: "Copyright (c) 2005, Ursina Caluori"
	license: "Eiffel Forum License v2 (see forum.txt)"
	date: "$Date $"
	revision: "$Revision $"
-->
<chapter xmlns="http://www.gobosoft.com/eiffel/gobo/documentation" id="traffic_developer/classes">
<chapterinfo>
	<copyright>
		<year>2005</year>
		<holder>Michela Pedroni</holder>
	</copyright>
	<author>
		<firstname>Michela</firstname><surname>Pedroni</surname>
	</author>
	<email>michela.pedroni@inf.ethz.ch</email>
	<date>19. October 2005</date>
</chapterinfo>
    <title>Classes</title>
	<section id="top_of_page">
    	<para>
			In the following sections the classes will be described. The layout for each class is: 
			Requirements, Description, Class overview. In the Requirements the name of classes you 
			need to know in order to understand the class described is given. Description is a short 
			description of what the class does. It is more detailed than just the class description 
			that you find in the class header. The class overview provides you with a class diagram. 
		</para>
		<itemizedlist>
			<listitem>
				<link url="#traffic_color">TRAFFIC_COLOR</link>
			</listitem>
			<listitem>
				<link url="#traffic_line">TRAFFIC_LINE</link>
			</listitem>
			<listitem>
				<link url="#traffic_line_section">TRAFFIC_LINE_SECTION</link>
			</listitem>
			<listitem>
				<link url="#traffic_line_section_state">TRAFFIC_LINE_SECTION_STATE</link>
			</listitem>
			<listitem>
				<link url="#traffic_line_section_state_constants">TRAFFIC_LINE_SECTION_STATE_CONSTANTS</link>
			</listitem>
			<listitem>
				<link url="#traffic_map">TRAFFIC_MAP</link>
			</listitem>
			<listitem>
				<link url="#traffic_map_factory">TRAFFIC_MAP_FACTORY</link>
			</listitem>
			<listitem>
				<link url="#traffic_place">TRAFFIC_PLACE</link>
			</listitem>
			<listitem>
				<link url="#traffic_place_information">TRAFFIC_PLACE_INFORMATION</link>
			</listitem>
			<listitem>
				<link url="#traffic_route">TRAFFIC_ROUTE</link>
			</listitem>
			<listitem>
				<link url="#traffic_simple_line">TRAFFIC_SIMPLE_LINE</link>
			</listitem>
			<listitem>
				<link url="#traffic_type">TRAFFIC_TYPE</link>
			</listitem>
			<listitem>
				<link url="#traffic_type_factory">TRAFFIC_TYPE_FACTORY</link>
			</listitem>
		</itemizedlist>
    </section>
    <section id="traffic_color">
    	<title>TRAFFIC_COLOR</title>
   		<title>Requirements:</title>
    	<para>
    		None
    	</para>
    	<title>Description</title>
    	<para>
    		The class TRAFFIC_COLOR represents a RGB-Color. A RGB-Color is a color composed of the
    		three additive components: red, green, blue. The three color parts can be accessed 
    		through the three features: <featurename>red</featurename>, <featurename>green</featurename>, 
    		<featurename>blue</featurename>. An important feature is <featurename>is_valid_color_part
    		</featurename> which makes sure only valid integer values for the rgb-parts are used.
    		The object is created through the <featurename>make</featurename> feature call which sets 
    		the color parts to the passed values. The individual color parts can be changed through 
    		the <featurename>set_color</featurename> commands. Make sure the value you want to 
    		change the color to is valid. For this the <featurename>is_valid_color_part</featurename>
    		query can be used.
    	</para>
    	<title>Class overview</title>
    	<para>
    	<para>
    		<image src="image/sg_traffic_color.png"/>
    	</para>
    	</para>
    	<toplink/>
    </section>
    <section id="traffic_line">
    	<title>TRAFFIC_LINE</title>
   		<title>Requirements:</title>
    	<para>
    		<link url="#traffic_color">TRAFFIC_COLOR</link>, <link url="#traffic_place">TRAFFIC_PLACE</link>,
    		<link url="#traffic_line_section">TRAFFIC_LINE_SECTION</link>, <link url="#traffic_type">
    		TRAFFIC_TYPE</link>
    	</para>
    	<title>Description</title>
    	<para>
    		The class <classname>TRAFFIC_LINE</classname> models a line of a public transportation system. 
    		Each line has a type, e.g. <classname>TRAFFIC_TYPE_BUS</classname> for a bus line, <classname>
    		TRAFFIC_TYPE_RAIL</classname> for a rail line and so on. This type can be accessed through the 
    		feature <featurename>type</featurename>. In addition a line can have up to two directions. 
    		A line which only has one direction is also valid. Each direction has a terminal place. 
    	</para>
    	<para>	
			A new line is created through the feature <featurename>make</featurename>. It takes as input
			the name of your new line and a traffic type. The features <featurename>name</featurename>, 
    		<featurename>color</featurename>, <featurename>type</featurename>, <featurename>terminal_1
    		</featurename>, <featurename>terminal_2</featurename> can directly be called. 
    	</para>
    	<para>
    		If you want to get the starting place of a direction of your line use the feature <featurename>
    		start_to_terminal</featurename>. It takes as input either the place in <featurename>terminal_1
    		</featurename> or <featurename>terminal_2</featurename>. If you use just a place, make sure 
    		it is a terminal in a direction of the line. To make sure that a place is a terminal the 
    		<featurename>is_terminal</featurename> query can be used. The features <featurename>
    		one_direction_exists</featurename> and <featurename>other_direction_exists</featurename> return 
    		true if one or other direction (depending on the feature you call) exists. Only if a direction 
    		exists there exists a terminal and a starting place. 
    	</para>
    	<para>
    		The query <featurename>is_valid_for_insertion </featurename> tells you if a line section, as it 
    		is, can be inserted into the line. The query <featurename>is_valid_insertion</featurename> tells
    		you if it is possible for a line section of the correct type from a origin place to a destination 
    		place is a possible extension of the line in any direction. So the argument in the second query 
    		(<featurename>is_valid_insertion</featurename>)	is only the origin and destination of a fictionary
    		or real line section. <featurename>Extend</featurename> adds a line section to the line where
    		it fits. So directions can be extended at both their beginning and their end.
    	</para>
    	<para>
    		The color of a line can be changed or removed through the features <featurename>set_color
    		</featurename> and <featurename>remove_color</featurename>. 
        </para>
    	<title>Class overview</title>
    	<para>
    	<para>
    		<image src="image/sg_traffic_line.png"/>
    	</para>
    	</para>
    	<toplink/>
    </section>
    <section id="traffic_line_section">
    	<title>TRAFFIC_LINE_SECTION</title>
   		<title>Requirements:</title>
    	<para>
    		<link url="#traffic_place">TRAFFIC_PLACE</link>, <link url="#traffic_line_section">
    		TRAFFIC_LINE_SECTION</link>, <link url="#traffic_line_state">TRAFFIC_LINE_STATE</link>
	   	</para>
    	<title>Description</title>
    	<para>
			The class <classname>TRAFFIC_LINE_SECTION</classname> represents a connection of a line 
			from one place to another. Those places are called origin and destination. A line section 
			is of some traffic type, e.g. <classname>TRAFFIC_BUS_TYPE</classname>. A line section can 
			be added to a line, forming the lines connection. It can belong to at most one line. 
			Additionally a line section can have different states.
    	</para>
    	<para>
			To create a new line section an origin place, a destination place and a traffic type have 
			to be defined. Such a line section will not belong to any line, its state will be set to
			some normal state and the polypoints are empty.    	
		</para>
		<para>
			The feature <featurename>length</featurename> returns a calculated length of the line section.
			To calculate the length the polypoints are used, and if no polypoints exists, the position 
			of the origin and destination place are used to calculate a length. This length becomes 
			especially important when starting to calculate routes on lines and even a whole map of lines.
		</para>
		<para>
			The changement of the attached line can only be carried out by a line. This is due to the fact, 
			that when a line section has a line attached it should be in this line. Therefore the line 
			is responsible to update line sections that are added to or removed from it.
		</para>
    	<title>Class overview</title>
    	<para>
    	<para>
    		<image src="image/sg_traffic_line_section.png"/>
    	</para>
     	</para>
    	<toplink/>
    </section>
    <section id="traffic_line_section_state">
    	<title>TRAFFIC_LINE_SECTION_STATE</title>
   		<title>Requirements:</title>
    	<para>
    		<link url="#traffic_line_section_state_constants">TRAFFIC_LINE_SECTION_STATE_CONSTANTS</link>
	   	</para>
    	<title>Description</title>
    	<para>
			The class <classname>TRAFFIC_LINE_SECTION_STATE</classname> provides the interface to define 
			states and attach them to line sections. The available states are defined from the 
			<classname>TRAFFIC_LINE_SECTION_STATE_CONSTANTS</classname> class.    	
		</para>
    	<para>
			 A new state is simply created by calling its creation feature. The feature <featurename>make
			 </featurename> always creates a normal state. To change it, call the feature <featurename>
			 set_state</featurename> with one of the values defined in <classname>
			 TRAFFIC_LINE_SECTION_STATE_CONSTANTS</classname>.    	
		</para>
    	<title>Class overview</title>
    	<para>
    	<para>
    		<image src="image/sg_traffic_line_section_state.png"/>
    	</para>
     	</para>
    	<toplink/>
    </section>
    <section id="traffic_line_section_state_constants">
    	<title>TRAFFIC_LINE_SECTION_STATE_CONSTANTS</title>
   		<title>Requirements:</title>
    	<para>
    		None
	   	</para>
    	<title>Description</title>
    	<para>
			The class <classname>TRAFFIC_LINE_SECTION_STATE_CONSTANTS</classname> defines all line 
			section states and has the feature <featurename>is_valid_state_value</featurename> that 
			tests any integer value to the states value and the feature <featurename>value_to_string
			</featurename> that returns a string representation of the state value.    	
		</para>
    	<title>Class overview</title>
    	<para>
    	<para>
    		<image src="image/sg_traffic_line_section_state_constants.png"/>
    	</para>
     	</para>
    	<toplink/>
    </section>
    <section id="traffic_map">
    	<title>TRAFFIC_MAP</title>
   		<title>Requirements:</title>
    	<para>
   			<link url="#traffic_line">TRAFFIC_LINE</link>, <link url="#traffic_place">TRAFFIC_PLACE</link>,
    		<link url="#traffic_line_section">TRAFFIC_LINE_SECTION</link>
 	   	</para>
    	<title>Description</title>
    	<para>
			The <classname>TRAFFIC_MAP</classname> is the collection of all lines, line sections and places.
			All elements are administrated by the map. Through the name of a place or a line you can 
			retrieve it, you can search for line sections and even search shortest paths from one place
			to another. A map has a name and can additionally have a description that gives more 
			information on the purpose of the map.   	
		</para>
		<para>
			The name and the description can be accessed through the features <featurename>name
			</featurename> and <featurename>description</featurename>. Additionally a place of 
			a given name can be accessed through the feature <featurename>place</featurename>.
			For all the elements of the map there exist features to find out whether there is 
			such an element (<featurename>has_place</featurename>, <featurename>has_line</featurename>
			and <featurename>has_line_section</featurename>). To add new elements to the map use the
			features <featurename>add_place</featurename>, <featurename>add_line</featurename> or
			<featurename>add_line_section</featurename>.
		</para>
    	<title>Class overview</title>
    	<para>
    	<para>
    		<image src="image/sg_traffic_map.png"/>
    	</para>
     	</para>
    	<toplink/>
    </section>
    <section id="traffic_map_factory">
    	<title>TRAFFIC_MAP_FACTORY</title>
   		<title>Requirements:</title>
    	<para>
   			<link url="#traffic_line">TRAFFIC_LINE</link>, <link url="#traffic_place">TRAFFIC_PLACE</link>,
    		<link url="#traffic_line_section">TRAFFIC_LINE_SECTION</link>, <link url="#traffic_simple_line">
    		TRAFFIC_SIMPLE_LINE</link>, <link url="#traffic_map">TRAFFIC_MAP</link>,
    		<link url="#traffic_type">TRAFFIC_TYPE</link>, <link url="#traffic_type_factory">
    		TRAFFIC_TYPE_FACTORY</link>
 	   	</para>
    	<title>Description</title>
    	<para>
			The <classname>TRAFFIC_MAP_FACTORY</classname> is used to create a map and its elements. 
			The general principle is easy. Call the corresponding build feature. Test with the 
			has-features if a valid object was created and access the last created object of a 
			given element type with the corresponding query.		
		</para>
		<para>
			Create a new factory by calling it's <featurename>make</featurename> feature. This 
			creates a new, blank factory. With the <featurename>reset</featurename> feature you
			can reset a factory to create a new map and it's elements from scratch.
		</para>
		<para>
			At first you possibly want to build a map to be able to insert the maps elements 
			afterwards. The build feature that builds a named map is called <featurename>build_map
			</featurename>. The query <featurename>map</featurename> returns the last created 
			map. With the call to the query <featurename>has_map</featurename> you make sure a
			valid map exists. After a successful call to this feature it is safe to call <featurename>
			map</featurename>. To build a place there are two features: to build a standard place whose 
			position is at the origin (0,0) you call <featurename>build_place</featurename>; to build 
			a place with another position call <featurename>build_place_with_position</featurename>. 
			The features <featurename>has_place</featurename> and <featurename>place</featurename> 
			have the same meaning as already mentioned generally. The building and accessing of a line
			section object works as with the other elements. The build features may look a little bit
			complicated with a long list of arguments, but the definition of a line section is quite
			large. A line section has an origin and destination place and a type. Additionally it can 
			have polypoints defining its appearance and a line it belongs to. Therefore all these arguments 
			have to be given to the build features of the line section.
		</para>
    	<title>Class overview</title>
    	<para>
    	<para>
    		<image src="image/sg_traffic_map_factory.png"/>
    	</para>
     	</para>
    	<toplink/>
    </section>
    <section id="traffic_place">
    	<title>TRAFFIC_PLACE</title>
   		<title>Requirements:</title>
    	<para>
   			<link url="#traffic_place_information">TRAFFIC_PLACE_INFORMATION</link>
 	   	</para>
    	<title>Description</title>
    	<para>
			The class <classname>TRAFFIC_PLACE</classname> represents a place in a city. It can 
			have additional information like one ore more pictures and a description attached to
			it. Additionally it can have a position.		
		</para>
		<para>
			There exist two different ways to create a new place. The first way is to only define
			a name of the place, the position will be set to default (feature <featurename>
			make</featurename>). The second one is to also give its position to the creation feature
			(feature <featurename>make</featurename>).
		</para>
		<para>
			The name, position and information can be accessed through the according features. 
			The information can be Void, whereas the name and position should never be void. 
			The information and position can also be changed during the lifetime of a place object.
		</para>
    	<title>Class overview</title>
    	<para>
    	<para>
    		<image src="image/sg_traffic_place.png"/>
    	</para>
     	</para>
    	<toplink/>
    </section>
   <section id="traffic_place_information">
    	<title>TRAFFIC_PLACE_INFORMATION</title>
   		<title>Requirements:</title>
    	<para>
   			LINKED_LIST
 	   	</para>
    	<title>Description</title>
    	<para>
			The class <classname>TRAFFIC_PLACE_INFORMATION</classname> is a collection of additional 
			information for a place. This can be one or more pictures (path to the pictures) and a 
			textual description.
		</para>
		<para>
			A picture is added with the feature <featurename>extend_picture</featurename> and a 
			description is added with the command <featurename>set_description</featurename>.
			To delete a picture you have to know its path and use the command <featurename>
			remove_picture</featurename>. To remove a description just call <featurename>
			remove_description</featurename>.		
		</para>
    	<title>Class overview</title>
    	<para>
    	<para>
    		<image src="image/sg_traffic_place_information.png"/>
    	</para>
     	</para>
     	<toplink/>
    </section>
   <section id="traffic_route">
    	<title>TRAFFIC_ROUTE</title>
   		<title>Requirements:</title>
    	<para>
   			<link url="#traffic_place">TRAFFIC_PLACE</link>, <link url="#traffic_line_section">
   			TRAFFIC_LINE_SECTION</link>
 	   	</para>
    	<title>Description</title>
    	<para>
			The class <classname>TRAFFIC_ROUTE</classname> calculates the shortest path for a set 
			of places you want to visit on a given map. You can change the route by adding or removing 
			places you want to visit with the features <featurename>extend</featurename> and
			<featurename>remove</featurename>.		
		</para>
		<para>
			After calculating a route through the feature <featurename>calculate_shortest_path
			</featurename> the places and used line sections that are on the route can be accessed 
			through <featurename>places_on_route</featurename> and <featurename>line_sections</featurename>.
		</para>
    	<title>Class overview</title>
    	<para>
    	<para>
    		<image src="image/sg_traffic_route.png"/>
    	</para>
     	</para>
    	<toplink/>
    </section>
   <section id="traffic_simple_line">
    	<title>TRAFFIC_SIMPLE_LINE</title>
   		<title>Requirements:</title>
    	<para>
   			<link url="#traffic_line">TRAFFIC_LINE</link>
 	   	</para>
    	<title>Description</title>
    	<para>
			<classname>TRAFFIC_SIMPLE_LINE</classname> is a line that always has a line section in 
			both directions. So if you add a line section from place A to place B the line section 
			from place B to place A will be added as well. As a result you get a symmetric line.		
		</para>
		<para>
			The only feature that differs from the features of class <link url="#traffic_line">
			<classname>TRAFFIC_LINE</classname></link> is the creation feature
			that has an additional argument: the traffic map that the simple line (and consequently its 
			line sections) is in.
		</para>
    	<title>Class overview</title>
    	<para>
    	<para>
    		<image src="image/sg_traffic_simple_line.png"/>
    	</para>
     	</para>
    	<toplink/>
    </section>
  <section id="traffic_type">
    	<title>TRAFFIC_TYPE</title>
   		<title>Requirements:</title>
    	<para>
   			None
 	   	</para>
    	<title>Description</title>
    	<para>
			The class <classname>TRAFFIC_TYPE</classname> is used to identify the type of a line 
			or line_section. <classname>TRAFFIC_TYPE</classname> is the abstract class of all 
			possible traffic types. Traffic types are mainly used to make sure that only line 
			sections of a given type can be added to a line of some type. This is done to ensure 
			that no bus drives on a rail way and so on.	
		</para>
		<para>
			The traffic type classes have one interesting query: <featurename>name</featurename> 
			returns a textual representation of the traffic type.
		</para>
    	<title>Class overview</title>
    	<para>
    	<para>
    		<image src="image/sg_traffic_type.png"/>
    	</para>
     	</para>
    	<toplink/>
    </section>
  <section id="traffic_type_factory">
    	<title>TRAFFIC_TYPE_FACTORY</title>
   		<title>Requirements:</title>
    	<para>
   			None
 	   	</para>
    	<title>Description</title>
    	<para>
			The class <classname>TRAFFIC_TYPE_FACTORY</classname> creates singleton traffic types. 
			This means you get the same type object every time you build a type. This makes it 
			easier to compare two objects of a given traffic type: you can simply compare the 
			references of the type. If they are identical the type of the two objects those type 
			references belong to are the same.
		</para>
		<para>
			The feature <featurename>valid_name</featurename> tests, if the name given as argument
			is a valid name of a traffic type. For valid names, traffic types can be built. The 
			query <featurename>has_type</featurename> tells you whether the last call to build 
			was successful.
		</para>
		<para>
			The factory can be reset by the <featurename>reset</featurename> feature call. The 
			most important feature of the factory is <featurename>build</featurename>. It 
			generates a traffic type of the specified type. If you are not sure about the string, 
			call <featurename>valid_name</featurename> to assure, that the type you want to build 
			is a valid one. The last created type of the factory can be accessed with the call to
			<featurename>traffic_type</featurename>. The query <featurename>has_type</featurename> 
			returns true if the type could be built.
		</para>
    	<title>Class overview</title>
    	<para>
    	<para>
    		<image src="image/sg_traffic_type_factory.png"/>
    	</para>
     	</para>
    	<toplink/>
    </section>
</chapter>
